<!DOCTYPE html><html class="theme-next mist use-motion" lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><script>!function(e,t,o,c,i,a,n){e.DaoVoiceObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement(o),n=t.getElementsByTagName(o)[0],a.async=1,a.src=c,a.charset="utf-8",n.parentNode.insertBefore(a,n)}(window,document,"script",("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/0f81ff2f.js","daovoice"),daovoice("init",{app_id:"50185433"}),daovoice("update")</script><script src="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script><link href="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-minimal.min.css" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="https://fonts.cat.net/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Cookie:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="/alex.d-blog/css/main.css?v=6.4.2" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/alex.d-blog/images/logo-180x180.jpg?v=6.4.2"><link rel="icon" type="image/png" sizes="32x32" href="/alex.d-blog/images/favicon-32x32.ico?v=6.4.2"><link rel="icon" type="image/png" sizes="16x16" href="/alex.d-blog/images/favicon-16x16.ico?v=6.4.2"><link rel="mask-icon" href="/alex.d-blog/images/logo.svg?v=6.4.2" color="#222"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/alex.d-blog/",scheme:"Mist",version:"6.4.2",sidebar:{position:"left",width:320,display:"hide",offset:12,b2t:!1,scrollpercent:!0,onmobile:!0},fancybox:!1,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!0,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="本文记录本地Windows下SonarQube Server及SonarQube Databse环境的配置。"><meta name="keywords" content="Windows,SonarQube,代码质量,代码分析"><meta property="og:type" content="article"><meta property="og:title" content="Windows系统配置SonarQube本地服务"><meta property="og:url" content="http://yoursite.com/posts/9232f8b8/index.html"><meta property="og:site_name" content="Alex.D&#39;s Bolg"><meta property="og:description" content="本文记录本地Windows下SonarQube Server及SonarQube Databse环境的配置。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-6-SonarQube.jpg"><meta property="og:image" content="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-8-SonarQube_Architecture.png"><meta property="og:image" content="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonerqube_dic.png"><meta property="og:image" content="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_conf.png"><meta property="og:image" content="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_start.png"><meta property="og:image" content="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_web.png"><meta property="og:image" content="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_database.png"><meta property="og:image" content="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_token_1.png"><meta property="og:image" content="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_token_2.png"><meta property="og:image" content="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_workpage.png"><meta property="og:image" content="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_chinesepack.png"><meta property="og:image" content="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_install_1.png"><meta property="og:image" content="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_install_2.png"><meta property="og:image" content="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_error_0_deal.png"><meta property="og:image" content="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_error_1.png"><meta property="og:image" content="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_error_1_deal.png"><meta property="og:updated_time" content="2018-09-08T14:54:42.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Windows系统配置SonarQube本地服务"><meta name="twitter:description" content="本文记录本地Windows下SonarQube Server及SonarQube Databse环境的配置。"><meta name="twitter:image" content="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-6-SonarQube.jpg"><link rel="alternate" href="/alex.d-blog/rss.xml" title="Alex.D's Bolg" type="application/atom+xml"><link rel="canonical" href="http://yoursite.com/posts/9232f8b8/"><script type="text/javascript" id="page.configurations">CONFIG.page={sidebar:""}</script><title>Windows系统配置SonarQube本地服务 | Alex.D's Bolg</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?3a07652f23a7df84dd82ef48b0a358e1";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style type="text/css">.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.logo-line-after i{right:initial}</style></noscript></head><body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/alex.d-blog/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Alex.D's Bolg</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Don't trouble trouble until trouble troubles you.</h1></div><div class="site-nav-toggle"> <button aria-label="切换导航栏"><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/alex.d-blog/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-tags"><a href="/alex.d-blog/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签<span class="badge">40</span></a></li><li class="menu-item menu-item-categories"><a href="/alex.d-blog/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类<span class="badge">16</span></a></li><li class="menu-item menu-item-archives"><a href="/alex.d-blog/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档<span class="badge">28</span></a></li><li class="menu-item menu-item-about"><a href="/alex.d-blog/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-commonweal"><a href="/alex.d-blog/404/" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>公益 404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header> <a href="https://github.com/anyer" class="github-corner" target="_blank" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#222;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://yoursite.com/alex.d-blog/posts/9232f8b8/"><span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="name" content="Alex.D"><meta itemprop="description" content="Alex.D 个人博客，记录和分享工作经验、学习心得等"><meta itemprop="image" content="/alex.d-blog/images/avatar.jpg"></span><span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Alex.D's Bolg"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">Windows系统配置SonarQube本地服务</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-09-08 22:54:42" itemprop="dateCreated datePublished" datetime="2018-09-08T22:54:42+08:00">2018-09-08</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/alex.d-blog/categories/代码质量/" itemprop="url" rel="index"><span itemprop="name">代码质量</span></a></span> ， <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/alex.d-blog/categories/代码质量/SonarQube/" itemprop="url" rel="index"><span itemprop="name">SonarQube</span></a></span></span> <span id="/alex.d-blog/posts/9232f8b8/" class="leancloud_visitors" data-flag-title="Windows系统配置SonarQube本地服务"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><div class="post-symbolscount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">本文字数：</span> <span title="本文字数">4k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">4 分钟</span></div><div class="post-description">本文记录本地Windows下SonarQube Server及SonarQube Databse环境的配置。</div></div></header><div class="post-body" itemprop="articleBody"><h1 id="Windows系统配置SonarQube本地服务"><a href="#Windows系统配置SonarQube本地服务" class="headerlink" title="Windows系统配置SonarQube本地服务"></a>Windows系统配置SonarQube本地服务</h1><h2 id="SonarQube简介"><a href="#SonarQube简介" class="headerlink" title="SonarQube简介"></a><strong>SonarQube简介</strong></h2><p><img src="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-6-SonarQube.jpg" alt="SonarQube"></p><blockquote><p><a href="https://www.sonarqube.org/" target="_blank" rel="noopener">SonarQube</a> 是一个用于管理源代码质量开放平台，可以从多个维度检测代码质量，快速的定位代码中潜在的或者明显的 Bug、错误，提供重复代码、编码标准、单元测试、代码覆盖率、代码复杂度、潜在Bug、注释和软件设计报告。支持包括 Java、Python、Php、C/C++、C#、HTML、JavaScript、PL/SQL、Objective C 等二十多种编程语言的代码质量管理与检测。通过插件机制，SonarQube可以继承不同的测试工具，代码分析工具，以及持续集成工具。可与IDE（如：Eclipse、IDEA等）集成使用。</p></blockquote><p>SonarQube 并不是简单地直接将各种质量检测工具（例如 FindBugs，PMD 等）的结果展现给客户，而是通过不同的插件算法来对这些结果进行再加工，最终以量化的方式来衡量代码质量，从而方便地对不同规模和种类的工程进行相应的代码质量管理。更多相关介绍不在此赘述。</p><hr><h2 id="SonarQube架构"><a href="#SonarQube架构" class="headerlink" title="SonarQube架构"></a>SonarQube架构</h2><p>引用SonarQube官网提供的架构图，<br><img src="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-8-SonarQube_Architecture.png" alt="SonarQube 架构"><br>通过图中描述整个SonarQube的分析分为几个部分：</p><ul><li>待分析的项目源代码</li><li>SonarQube Scanner 源代码分析工具</li><li>SonarQube Server 提供服务，用来提供分析报表及解决方法</li><li>SonarQube Database 相关分析数据的持久化存储</li></ul><p>本文则根据主要描述，记录本地Windows下SonarQube Server及Databse的配置。主要环境如下：</p><ul><li>Windows 10</li><li>SonarQube 6.7 LTS</li><li>MySQL 5.7.21</li><li>JDK1.8.0_152</li><li>Maven 3.5.3</li></ul><hr><h2 id="SonarQube服务环境配置"><a href="#SonarQube服务环境配置" class="headerlink" title="SonarQube服务环境配置"></a><strong>SonarQube服务环境配置</strong></h2><h3 id="基本环境要求"><a href="#基本环境要求" class="headerlink" title="基本环境要求"></a><strong>基本环境要求</strong></h3><p>本文使用的版本为 SonarQube 6.7.5 LTS , <a href="https://www.sonarqube.org/downloads/" target="_blank" rel="noopener">官方下载地址</a>。安装的基本要求如下：</p><ul><li>运行SonarQube的唯一先决条件是在您的计算机上安装Java（<strong>Oracle JRE 8或OpenJDK 8</strong>）</li><li>SonarQube服务器需要至少2GB的RAM才能有效运行</li><li>需要的磁盘空间量取决于使用SonarQube分析的代码量</li><li>MySQL 5.6 +，仅支持InnoDB存储引擎，但不支持MyISAM</li><li>要获得SonarQube提供的完整体验，必须在浏览器中启用JavaScript，IE11+，其他浏览器建议最新版本</li></ul><p>更多环境要求，见官方文档官方，<a href="https://docs.sonarqube.org/display/SONARQUBE67/Requirements" target="_blank" rel="noopener">详见</a>。<br>另，需要分析Maven项目时，需要本地下载配置Maven，版本Maven 3.0+。</p><hr><h3 id="SonarQube环境配置"><a href="#SonarQube环境配置" class="headerlink" title="SonarQube环境配置"></a><strong>SonarQube环境配置</strong></h3><p>官网下载SonarQube后，解压到任意目录（建议，非中文目录），目录结构大致如下：</p><p><img src="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonerqube_dic.png" alt="SonarQube 目录结构"></p><p>各目录作用如下：</p><ul><li><strong>bin</strong> 此目录放置各操作系统（LInux、Windows、MacOS）用于启动 SonarQube 服务的工具、脚本；</li><li><strong>conf</strong> 此目录存放SonarQube相关配置文件；</li><li><strong>data</strong> 此目录包含嵌入式数据库(H2数据库引擎)的数据，建议只用于测试和演示；</li><li><strong>elasticsearch</strong> 此目录放置elasticsearch检索引擎相关内容；</li><li><strong>extensions</strong> 此目录存放SonarQube的插件、 扩展jar 包；</li><li><strong>lib</strong> 此目录存放SonarQube所依赖的 jar 包；</li><li><strong>logs</strong> 此目录存放SonarQube相关日志信息；</li><li><strong>tmp</strong>此目录包含服务器所需的临时数据，服务器启动时不要清理；</li><li><strong>web</strong> 此目录存放 SonarQube web 服务的静态资源。</li></ul><hr><h4 id="SonarQube服务数据库配置"><a href="#SonarQube服务数据库配置" class="headerlink" title="SonarQube服务数据库配置"></a><strong>SonarQube服务数据库配置</strong></h4><p>SonarQube 支持大多数主流关系型数据库（例如 Microsoft SQL Server, MySQL, Oracle, PostgreSQL 等）,默认使用H2数据库，可以直接运行启动，此处配置MySQL数据库。</p><ol><li><p>MySQL创建数据库</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> sonar <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci;</span><br></pre></td></tr></table></figure></li><li><p>分配用户及权限</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   	</span><br><span class="line">   <span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'sonar'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'sonar'</span>;</span><br><span class="line">   <span class="keyword">GRANT</span> ALL <span class="keyword">ON</span> sonar.* <span class="keyword">TO</span> <span class="string">'sonar'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'sonar'</span>; </span><br><span class="line">   <span class="keyword">GRANT</span> ALL <span class="keyword">ON</span> sonar.* <span class="keyword">TO</span> <span class="string">'sonar'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'sonar'</span>;</span><br><span class="line"><span class="keyword">FLUSH</span> <span class="keyword">PRIVILEGES</span>;</span><br></pre></td></tr></table></figure></li><li><p>修改SonarQube配置文件<br>找到 <code>..\sonarqube-6.7.5\conf</code> 目录下的 <code>sonar.properties</code>，首先搜索 <code># User credentials.</code> 配置JDBC连接的用户名及密码（此处为上步创建的用户）：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sonar.jdbc.username=sonar</span><br><span class="line">sonar.jdbc.password=sonar</span><br></pre></td></tr></table></figure><p>搜索 <code>MySQL 5.6 or greater</code> ，配置数据库链接 URL :</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sonar.jdbc.url=jdbc:mysql://localhost:3306/sonar?useUnicode=true&amp;characterEncoding=utf8&amp;rewriteBatchedStatements=true&amp;useConfigs=maxPerformance&amp;useSSL=false</span><br></pre></td></tr></table></figure><p>到此完成了 MySQL 的简单配置</p><p><img src="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_conf.png" alt="SonarQube 配置MySQL"></p><p><strong>注意：</strong> SonarQube支持的为InnoDB引擎，可以在MySQL配置文件内的 [mysqld] 下配置 <code>default-storage-engine=INNODB</code> 来实现创建的表默认使用 InnoDB 引擎。</p></li></ol><hr><h4 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a><strong>启动服务</strong></h4><p>在目录 <code>..\sonarqube-6.7.5\bin\windows-x86-64</code> 下，双击 <code>StartSonar.bat</code> 启动服务，出现 <code>[o.s.a.SchedulerImpl] Process[es] is up</code> 提示时，表示 <code>elasticsearch</code> 启动成功</p><p><img src="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_start.png" alt="SonarQube 服务启动"></p><p>此时，可以在浏览器内访问 <code>http://localhost:9000</code> 来登陆SonarQube管理页面 （<strong>注意，运行期间不要关闭命令行</strong>）</p><p><img src="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_web.png" alt="enter description here"></p><p>首次启动时，会在配置MySQL数据库内生成相关的表及初始化数据</p><p><img src="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_database.png" alt="SonarQube 数据库初始化"></p><p>到此SonarQube服务启动成功，如想修改访问端口等内容，在 <code>..\sonarqube-6.7.5\conf\sonar.properties</code>文件内修改。</p><p>在目录 <code>..\sonarqube-6.7.5\bin\windows-x86-64</code> 下可以看到多个bat批处理文件</p><ul><li>InstallNTService.bat 安装sonarqube为系统服务</li><li>StartNTService.bat 启动sonarqube系统服务</li><li>StartSonar.bat 命令行启sonarqube服务（关闭命令行即关闭服务）</li><li>StopNTService.bat 停止sonarqube系统服务</li><li>UninstallNTService.bat 卸载sonarqube系统服务</li></ul><p>为了方便，且防止命令行意外关闭导致服务停止等情况，可以通过管理员方式运行 <code>InstallNTService.bat</code> ，将SonarQube服务添加到系统服务中， 或使用 <code>sc</code> 命令自行添加。如出现服务添加到系统服务后，启动立即停止的情况，则通过查看 <code>..\sonarqube-6.7.5\log</code> 目录下的日志来查看问题，如无日志，尝试卸载服务，尝试使用 <code>sc</code> 命令添加服务。更多 <code>sc</code> 命令内容参看<a href="https://baike.baidu.com/item/sc%E5%91%BD%E4%BB%A4" target="_blank" rel="noopener">百度百科</a></p><hr><h4 id="插件安装"><a href="#插件安装" class="headerlink" title="插件安装"></a>插件安装</h4><p>启动服务后，可以在SonarQube管理页面的应用市场内添加需要的插件，如汉化包、代码分析插件：</p><ul><li>Chinese Pack 汉化包插件</li><li>Findbugs</li><li>Checkstyle</li><li>PMD</li></ul><p>服务页面点击登陆，输入用户名密码 ，默认为 <code>admin / admin</code>， 默认密码可以在 <code>..\sonarqube-6.7.5\conf\sonar.properties</code>文件内修改。</p><p>首次登陆账号，会提示配置分析的项目及token，可跳过</p><p><img src="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_token_1.png" alt="SonarQube 首次启动配置"></p><p><img src="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_token_2.png" alt="SonarQube 首次启动配置2"></p><p>配置完成后，点击 <code>Finish..</code>，进入操作页面</p><p><img src="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_workpage.png" alt="SonarQube 操作页面"></p><p>下面安装 <code>Chinese Pack (汉化包）</code>，演示插件安装。</p><p>导航栏选择 <code>Administration</code>跳转到Administration页面，选择 <code>Marketplace</code> 进入应用市场</p><p><img src="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_chinesepack.png" alt="SonarQube 安装汉化包"></p><p>安装完成后，出现类似如下提示，点击 <code>restart</code> 重启服务即可</p><p><img src="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_install_1.png" alt="SonarQube 安装完成提示"></p><p>等待几秒钟，服务会自动重启，重新登录后，可以看到汉化结果</p><p><img src="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_install_2.png" alt="SonarQube 汉化结果"></p><p>其他插件安装类似如上操作，根据需要选择安装即可。</p><hr><h2 id="安装相关问题记录及处理"><a href="#安装相关问题记录及处理" class="headerlink" title="安装相关问题记录及处理"></a><strong>安装相关问题记录及处理</strong></h2><h3 id="启动服务时，提示-“Unable-to-start-JVM”"><a href="#启动服务时，提示-“Unable-to-start-JVM”" class="headerlink" title="启动服务时，提示 “Unable to start JVM”"></a>启动服务时，提示 “Unable to start JVM”</h3><p>出现类似提示时，可以尝试在文件 <code>..\sonarqube-6.7.5\conf\wrapper.conf</code> 中添加Java JDK的路径，一般正常配置了Java环境变量，此处不需要配置。</p><p><img src="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_error_0_deal.png" alt="SonarQube Java JDK问题"></p><hr><h3 id="启动服务时，提示“另一个程序正在使用此文件，进程无法访问。”"><a href="#启动服务时，提示“另一个程序正在使用此文件，进程无法访问。”" class="headerlink" title="启动服务时，提示“另一个程序正在使用此文件，进程无法访问。”"></a>启动服务时，提示“另一个程序正在使用此文件，进程无法访问。”</h3><p>启动服务时，出现类似提示，是由于 <code>Java(TM) Platform SE binary</code>此后台进程没有关闭，导致jar包被加载占用，无法访问。</p><p><img src="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_error_1.png" alt="SonarQube Java后台占用"></p><p>此时使用任务管理器，关闭对应进程即可。</p><p><img src="http://p9uy5dyvc.bkt.clouddn.com/xsj/2018-9-7-sonarqube_error_1_deal.png" alt="SonarQube Java后台占用问题处理"></p><hr><h3 id="汉化包插件安装失败"><a href="#汉化包插件安装失败" class="headerlink" title="汉化包插件安装失败"></a><strong>汉化包插件安装失败</strong></h3><p>安装汉化包，重启后，一直重启状态，或出现其他错误提示，可以尝试在 <a href="https://github.com/SonarQubeCommunity/sonar-l10n-zh" target="_blank" rel="noopener">此处</a> 下载对应SonarQube版本的汉化包，下载完成后，提取jar包，放置到目录 <code>..\sonarqube-6.7.5\extensions\plugins</code> 下，重启服务即可。</p></div><div><div><div style="text-align:center;color:#ccc;font-size:16px">------ 全文结束<i class="fa fa-thumbs-up"></i> 感谢您的阅读!!! ------</div></div></div><div><div id="wechat_subscriber" style="display:block;padding:10px 0;margin:20px auto;width:100%;text-align:center"> <img id="wechat_subscriber_qcode" src="/alex.d-blog/images/weixingongzhonghao.png" alt="Alex.D wechat" style="width:200px;max-width:100%"><div></div></div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>坚持原创技术分享，您的支持将鼓励我继续创作！</div> <button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'> <span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"> <img id="wechat_qr" src="/alex.d-blog/images/wechatpay.jpg" alt="Alex.D 微信支付"><p>微信支付</p></div><div id="alipay" style="display:inline-block"> <img id="alipay_qr" src="/alex.d-blog/images/alipay.jpg" alt="Alex.D 支付宝"><p>支付宝</p></div></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> Alex.D</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="http://yoursite.com/posts/9232f8b8/" title="Windows系统配置SonarQube本地服务">http://yoursite.com/posts/9232f8b8/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/alex.d-blog/tags/Windows/" rel="tag"><i class="fa fa-tag"></i> Windows</a><a href="/alex.d-blog/tags/SonarQube/" rel="tag"><i class="fa fa-tag"></i> SonarQube</a><a href="/alex.d-blog/tags/代码质量/" rel="tag"><i class="fa fa-tag"></i> 代码质量</a><a href="/alex.d-blog/tags/代码分析/" rel="tag"><i class="fa fa-tag"></i> 代码分析</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/alex.d-blog/posts/38d24b30/" rel="next" title="Hexo博客快速生成"><i class="fa fa-chevron-left"></i> Hexo博客快速生成</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/alex.d-blog/posts/57e324c1/" rel="prev" title="Windows下配置SonarQube Scanner检测分析代码">Windows下配置SonarQube Scanner检测分析代码<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/alex.d-blog/images/avatar.jpg" alt="Alex.D"><p class="site-author-name" itemprop="name">Alex.D</p><p class="site-description motion-element" itemprop="description">Alex.D 个人博客，记录和分享工作经验、学习心得等</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/alex.d-blog/archives/"><span class="site-state-item-count">28</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/alex.d-blog/categories/index.html"><span class="site-state-item-count">16</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/alex.d-blog/tags/index.html"><span class="site-state-item-count">40</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/alex.d-blog/rss.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://blog.csdn.net/u012995964" target="_blank" title="CSDN" rel="external nofollow"><i class="fa fa-fw fa-link"></i> CSDN</a></span><span class="links-of-author-item"><a href="https://www.jianshu.com/u/059f6f3e5791" target="_blank" title="简书" rel="external nofollow"><i class="fa fa-fw fa-link"></i> 简书</a></span><span class="links-of-author-item"><a href="https://github.com/anyer" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://gitee.com/alex_d" target="_blank" title="Gitee" rel="external nofollow"><i class="fa fa-fw fa-link"></i> Gitee</a></span></div><div class="cc-license motion-element" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank" rel="external nofollow"><img src="/alex.d-blog/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Windows系统配置SonarQube本地服务"><span class="nav-number">1.</span> <span class="nav-text">Windows系统配置SonarQube本地服务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SonarQube简介"><span class="nav-number">1.1.</span> <span class="nav-text">SonarQube简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SonarQube架构"><span class="nav-number">1.2.</span> <span class="nav-text">SonarQube架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SonarQube服务环境配置"><span class="nav-number">1.3.</span> <span class="nav-text">SonarQube服务环境配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本环境要求"><span class="nav-number">1.3.1.</span> <span class="nav-text">基本环境要求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SonarQube环境配置"><span class="nav-number">1.3.2.</span> <span class="nav-text">SonarQube环境配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SonarQube服务数据库配置"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">SonarQube服务数据库配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#启动服务"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">启动服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#插件安装"><span class="nav-number">1.3.2.3.</span> <span class="nav-text">插件安装</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装相关问题记录及处理"><span class="nav-number">1.4.</span> <span class="nav-text">安装相关问题记录及处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#启动服务时，提示-“Unable-to-start-JVM”"><span class="nav-number">1.4.1.</span> <span class="nav-text">启动服务时，提示 “Unable to start JVM”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#启动服务时，提示“另一个程序正在使用此文件，进程无法访问。”"><span class="nav-number">1.4.2.</span> <span class="nav-text">启动服务时，提示“另一个程序正在使用此文件，进程无法访问。”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#汉化包插件安装失败"><span class="nav-number">1.4.3.</span> <span class="nav-text">汉化包插件安装失败</span></a></li></ol></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2015 – <span itemprop="copyrightYear">2018</span><span class="with-love" id="animate"><i class="fa fa-heartbeat"></i></span> <span class="author" itemprop="copyrightHolder">Alex.D</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">站点总字数：</span> <span title="站点总字数">81k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">1:14</span></div><div class="powered-by">由 <a class="theme-link" target="_blank" rel="external nofollow" href="https://hexo.io">Hexo</a> 强力驱动 v3.8.0</div> <span class="post-meta-divider">|</span><div class="theme-info">主题 – <a class="theme-link" target="_blank" rel="external nofollow" href="https://theme-next.org">NexT.Mist</a> v6.4.2</div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv" title="总访客量"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span><span class="site-pv" title="总访问量"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div><div><div class="addthis_inline_share_toolbox"><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5b1f1cb368ef81fb" async="async"></script></div></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.min.js"></script><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.ui.min.js"></script><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/canvas-nest.js/1.0.1/canvas-nest.min.js"></script><script type="text/javascript" src="/alex.d-blog/lib/three/three.min.js"></script><script type="text/javascript" src="/alex.d-blog/lib/three/three-waves.min.js"></script><script type="text/javascript" src="/alex.d-blog/js/src/utils.js?v=6.4.2"></script><script type="text/javascript" src="/alex.d-blog/js/src/motion.js?v=6.4.2"></script><script type="text/javascript" src="/alex.d-blog/js/src/scrollspy.js?v=6.4.2"></script><script type="text/javascript" src="/alex.d-blog/js/src/post-details.js?v=6.4.2"></script><script type="text/javascript" src="/alex.d-blog/js/src/bootstrap.js?v=6.4.2"></script><script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/alex.d-blog/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><script>
    
    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url }) })
        .done(function ({ results }) {
          if (results.length > 0) {
            var counter = results[0];
            
              var $element = $(document.getElementById(url));
              $element.find('.leancloud-visitors-count').text(counter.time + 1);
            
            Counter('put', `/classes/Counter/${counter.objectId}`, JSON.stringify({ time: { "__op":"Increment", "amount":1 } }))
            
            .fail(function ({ responseJSON }) {
                console.log('Failed to save Visitor num, with error message: ' + responseJSON.error);
            })
          } else {
            
              var $element = $(document.getElementById(url));
              $element.find('.leancloud-visitors-count').text('Counter not initialized! See more at console err msg.');
              console.error('ATTENTION! LeanCloud counter has security bug, see here how to solve it: https://github.com/theme-next/hexo-leancloud-counter-security. \n But you also can use LeanCloud without security, by set \'security\' option to \'false\'.');
            
          }
        })
      .fail(function ({ responseJSON }) {
        console.log('LeanCloud Counter Error:' + responseJSON.code + " " + responseJSON.error);
      });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + "bMq5EYdO7g53KqEdWTWkVm7I-gzGzoHsz")
        .done(function ({ api_server }) {
          var Counter = function (method, url, data) {
            return $.ajax({
              method: method,
              url: `https://${api_server}/1.1${url}`,
              headers: {
                'X-LC-Id': "bMq5EYdO7g53KqEdWTWkVm7I-gzGzoHsz",
                'X-LC-Key': "BVg4Pry8PJsDq6i9g8Iydm5M",
                'Content-Type': 'application/json',
              },
              data: data,
            });
          };
          
          addCount(Counter);
          
        })
    });
  </script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script type="text/javascript" src="/alex.d-blog/js/src/js.cookie.js?v=6.4.2"></script><script type="text/javascript" src="/alex.d-blog/js/src/scroll-cookie.js?v=6.4.2"></script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>$(".highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(t){var e=$(this).parent().find(".code").find(".line").map(function(t,e){return $(e).text()}).toArray().join("\n"),n=document.createElement("textarea");document.body.appendChild(n),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.value=e,n.select(),n.focus();var o=document.execCommand("copy");document.body.removeChild(n),o?$(this).text("复制成功"):$(this).text("复制失败"),$(this).blur()})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("复制")},300)}).append(e)})</script><script type="text/javascript" src="/alex.d-blog/js/src/love.js"></script></body></html>